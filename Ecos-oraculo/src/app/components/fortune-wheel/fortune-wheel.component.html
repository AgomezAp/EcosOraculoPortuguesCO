<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Documento</title>
  </head>
  <body>
    <div class="crystal-ball-container" [class.active]="isVisible">
      <div class="crystal-backdrop" (click)="onWheelClosedHandler()"></div>

      <div class="crystal-modal">
        <div class="crystal-header">
          <h2>Consulte o OrÃ¡culo CÃ³smico</h2>
          <button class="close-crystal-btn" (click)="onWheelClosedHandler()">
            âœ•
          </button>
        </div>

        <div class="crystal-content">
          <!-- Base ornamental -->
          <div class="crystal-base">
            <div class="base-details">
              <div class="base-ring"></div>
              <div class="base-runes">
                <span class="rune">âˆ´</span>
                <span class="rune">â‹„</span>
                <span class="rune">âˆ´</span>
              </div>
            </div>
          </div>

          <!-- Bola de cristal -->
          <div class="crystal-ball-wrapper">
            <div
              class="crystal-ball"
              #crystalElement
              [class.spinning]="wheelSpinning"
              [class.revealing]="selectedPrize && !wheelSpinning"
            >
              <!-- PartÃ­culas mÃ­sticas flotantes -->
              <div class="mystic-particles">
                <div
                  class="particle"
                  style="--delay: 0s; --x: 20%; --y: 30%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 1s; --x: 80%; --y: 20%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 2s; --x: 30%; --y: 70%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 3s; --x: 70%; --y: 80%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 4s; --x: 50%; --y: 40%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 5s; --x: 60%; --y: 60%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 6s; --x: 40%; --y: 20%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 7s; --x: 90%; --y: 50%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 8s; --x: 10%; --y: 80%"
                ></div>
                <div
                  class="particle"
                  style="--delay: 9s; --x: 75%; --y: 35%"
                ></div>
              </div>

              <!-- Energia mÃ­stica circular -->
              <div class="mystic-energy">
                <div class="energy-ring outer-ring"></div>
                <div class="energy-ring middle-ring"></div>
                <div class="energy-ring inner-ring"></div>
              </div>

              <!-- GalÃ¡xia interior girando -->
              <div
                class="galaxy-core"
                [style.transform]="
                  'translate(-50%, -50%) rotate(' + currentRotation + 'deg)'
                "
              >
                <div class="cosmic-dust"></div>
                <div class="stellar-field"></div>
                <div class="nebula-swirl"></div>
                <div class="center-orb"></div>
              </div>

              <!-- âœ… ATUALIZADO: Elementos flutuantes dos prÃªmios -->
              <div
                class="prize-elements"
                *ngIf="!wheelSpinning && !selectedPrize"
              >
                <div
                  *ngFor="let prize of prizes; let i = index"
                  class="floating-symbol"
                  [style.animation-delay]="i * 1 + 's'"
                >
                  <div class="symbol-glow">{{ prize.icon }}</div>
                </div>
              </div>

              <!-- âœ… ATUALIZADO: Resultado no centro -->
              <div
                class="crystal-result"
                *ngIf="selectedPrize && !wheelSpinning"
              >
                <div class="result-aura">
                  <div class="result-symbol">{{ selectedPrize.icon }}</div>
                  <div class="result-title">{{ selectedPrize.name }}</div>
                </div>
              </div>

              <!-- Reflexos e brilhos do cristal -->
              <div class="crystal-reflections">
                <div class="reflection primary-reflection"></div>
                <div class="reflection secondary-reflection"></div>
                <div class="reflection tertiary-reflection"></div>
              </div>

              <!-- Aura exterior -->
              <div class="crystal-aura"></div>
            </div>

            <!-- âœ… ATUALIZADO: BotÃ£o de ativaÃ§Ã£o com controle completo -->
            <div
              class="oracle-activation"
              [class.disabled]="
                !canSpinWheel || wheelSpinning || isProcessingClick
              "
              [class.processing]="isProcessingClick"
              (click)="spinWheel()"
            >
              <div class="activation-symbol">
                <!-- Estado normal: pode girar -->
                <div
                  *ngIf="!wheelSpinning && !isProcessingClick && canSpinWheel"
                  class="rune-circle"
                >
                  <span class="central-rune">â—Š</span>
                </div>

                <!-- Estado processando clique -->
                <div
                  *ngIf="isProcessingClick && !wheelSpinning"
                  class="processing-click"
                >
                  <div class="click-loader"></div>
                </div>

                <!-- Estado girando -->
                <div *ngIf="wheelSpinning" class="channeling-energy">
                  <div class="energy-spiral"></div>
                </div>

                <!-- Estado bloqueado -->
                <div
                  *ngIf="!canSpinWheel && !wheelSpinning && !isProcessingClick"
                  class="disabled-rune"
                >
                  <span class="locked-rune">ğŸ”’</span>
                </div>
              </div>

              <div class="activation-label">
                <!-- Texto quando pode girar -->
                <span
                  *ngIf="!wheelSpinning && !isProcessingClick && canSpinWheel"
                >
                  Consultar OrÃ¡culo
                </span>

                <!-- Texto processando -->
                <span *ngIf="isProcessingClick && !wheelSpinning">
                  Processando...
                </span>

                <!-- Texto quando estÃ¡ girando -->
                <span *ngIf="wheelSpinning">Canalizando Energias...</span>

                <!-- Texto quando jÃ¡ usou a tirada diÃ¡ria -->
                <span
                  *ngIf="
                    !canSpinWheel &&
                    !wheelSpinning &&
                    !isProcessingClick &&
                    hasUsedDailyFreeSpIn &&
                    !hasFreeSpinsAvailable()
                  "
                >
                  VocÃª jÃ¡ consultou hoje
                </span>

                <!-- Texto com tempo restante -->
                <span
                  *ngIf="
                    !canSpinWheel &&
                    !wheelSpinning &&
                    !isProcessingClick &&
                    !hasUsedDailyFreeSpIn
                  "
                >
                  PrÃ³xima consulta em: {{ getTimeUntilNextSpin() }}
                </span>

                <!-- Texto quando nÃ£o hÃ¡ tiradas disponÃ­veis -->
                <span
                  *ngIf="
                    !canSpinWheel &&
                    !wheelSpinning &&
                    !isProcessingClick &&
                    hasUsedDailyFreeSpIn &&
                    !hasFreeSpinsAvailable()
                  "
                >
                  Sem tiradas disponÃ­veis
                </span>
              </div>

              <!-- âœ… ATUALIZADO: Indicador de spins extras disponÃ­veis -->
              <div
                class="extra-spins-indicator"
                *ngIf="hasFreeSpinsAvailable()"
              >
                <span class="spins-count">
                  ğŸ° {{ getWheelSpinsCount() }} tiradas de roleta
                </span>
              </div>

              <!-- âœ… NOVO: Indicador de consultas disponÃ­veis -->
              <div
                class="dream-consultations-indicator"
                *ngIf="getDreamConsultationsCount() > 0"
              >
                <span class="consultations-count">
                  ğŸ”® {{ getDreamConsultationsCount() }} consultas de sonhos
                </span>
              </div>
            </div>
          </div>

          <!-- âœ… ATUALIZADO: InformaÃ§Ã£o de estado da roleta -->
          <div class="wheel-status">
            <div class="status-info">
              <!-- Info quando nÃ£o estÃ¡ girando nem processando -->
              <div
                class="spin-info"
                *ngIf="!wheelSpinning && !isProcessingClick"
              >
                <span
                  *ngIf="
                    canSpinWheel &&
                    !hasUsedDailyFreeSpIn &&
                    getWheelSpinsCount() === 0
                  "
                >
                  ğŸ Tirada diÃ¡ria gratuita disponÃ­vel
                </span>
                <span *ngIf="canSpinWheel && getWheelSpinsCount() > 0">
                  ğŸ° {{ getWheelSpinsCount() }} tiradas de roleta disponÃ­veis
                </span>
                <span *ngIf="!canSpinWheel && !hasFreeSpinsAvailable()">
                  â° Sem tiradas disponÃ­veis atÃ© amanhÃ£
                </span>
              </div>

              <!-- Info quando estÃ¡ processando -->
              <div
                class="processing-info"
                *ngIf="isProcessingClick && !wheelSpinning"
              >
                <div class="processing-animation">
                  <span class="process-icon">âš¡</span>
                  <span class="process-text">Preparando consulta...</span>
                </div>
              </div>

              <!-- Info quando estÃ¡ girando -->
              <div class="spinning-info" *ngIf="wheelSpinning">
                <div class="spin-animation">
                  <span class="swirl-icon">ğŸŒªï¸</span>
                  <span class="spin-text"
                    >As energias cÃ³smicas estÃ£o decidindo...</span
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- âœ… ATUALIZADO: Mensagem mÃ­stica durante spinning -->
          <div class="cosmic-message" *ngIf="wheelSpinning">
            <div class="message-text">
              <h3>As forÃ§as cÃ³smicas revelam seu destino</h3>
              <div class="cosmic-dots">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
              </div>
            </div>
          </div>

          <!-- âœ… ATUALIZADO: Resultado final -->
          <div
            class="oracle-revelation"
            *ngIf="selectedPrize && !wheelSpinning"
          >
            <div class="revelation-scroll">
              <h3>O OrÃ¡culo Falou</h3>
              <div class="destiny-manifest">
                <div class="manifest-symbol">{{ selectedPrize.icon }}</div>
                <div class="manifest-text">{{ selectedPrize.name }}</div>
              </div>

              <!-- âœ… ATUALIZADO: InformaÃ§Ã£o especÃ­fica do prÃªmio -->
              <div class="prize-description" *ngIf="selectedPrize">
                <p *ngIf="selectedPrize.id === '1'">
                  ğŸ° VocÃª ganhou 3 tiradas adicionais para a roleta do orÃ¡culo
                  <br /><strong
                    >Tiradas disponÃ­veis: {{ getWheelSpinsCount() }}</strong
                  >
                </p>
                <p *ngIf="selectedPrize.id === '2'">
                  ğŸ”® Uma consulta gratuita de interpretaÃ§Ã£o de sonhos te espera
                  <br /><strong
                    >Consultas disponÃ­veis:
                    {{ getDreamConsultationsCount() }}</strong
                  >
                </p>
                <p *ngIf="selectedPrize.id === '3'">
                  ğŸ¯ 2 tiradas extras de roleta foram adicionadas Ã  sua conta
                  <br /><strong
                    >Tiradas disponÃ­veis: {{ getWheelSpinsCount() }}</strong
                  >
                </p>
                <p *ngIf="selectedPrize.id === '4'">
                  ğŸ”„ As energias te concedem uma tirada imediata adicional
                  <br /><strong
                    >Tiradas disponÃ­veis: {{ getWheelSpinsCount() }}</strong
                  >
                </p>
              </div>

              <!-- âœ… NOVO: BotÃµes inteligentes segundo o tipo de prÃªmio -->
              <div class="prize-actions">
                <!-- âœ… BOTÃƒO CONTINUAR para prÃªmios que concedem tiradas -->
                <button
                  class="continue-spinning-btn"
                  (click)="continueSpinning()"
                  *ngIf="
                    shouldShowContinueButton(selectedPrize) &&
                    getWheelSpinsCount() > 0
                  "
                >
                  <span class="continue-icon">ğŸ²</span>
                  Â¡Continuar Girando! ({{ getWheelSpinsCount() }} tiradas)
                </button>

                <!-- âœ… MENSAGEM quando ganhou tiradas mas jÃ¡ nÃ£o tem mais -->
                <div
                  class="no-more-spins-message"
                  *ngIf="
                    shouldShowContinueButton(selectedPrize) &&
                    getWheelSpinsCount() === 0
                  "
                >
                  <p>ğŸ¯ PrÃªmio reclamado corretamente</p>
                  <button
                    class="accept-destiny-btn"
                    (click)="onWheelClosedHandler()"
                  >
                    Fechar
                  </button>
                </div>

                <!-- âœ… BOTÃƒO FECHAR sÃ³ para consulta grÃ¡tis -->
                <button
                  class="accept-destiny-btn"
                  (click)="onWheelClosedHandler()"
                  *ngIf="shouldShowCloseButton(selectedPrize)"
                >
                  Aceitar Destino
                </button>
              </div>

              <!-- âœ… NOVO: Estado atual de recursos -->
              <div class="current-resources" *ngIf="selectedPrize">
                <h4>ğŸ“Š Recursos Atuais:</h4>
                <div class="resource-summary">
                  <div class="resource-item">
                    <span class="resource-icon">ğŸ°</span>
                    <span class="resource-count">{{
                      getWheelSpinsCount()
                    }}</span>
                    <span class="resource-label">Tiradas de Roleta</span>
                  </div>
                  <div class="resource-item">
                    <span class="resource-icon">ğŸ”®</span>
                    <span class="resource-count">{{
                      getDreamConsultationsCount()
                    }}</span>
                    <span class="resource-label">Consultas disponÃ­veis</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- âœ… NOVO: Painel de recursos disponÃ­veis -->
          <div class="resources-panel" *ngIf="!wheelSpinning && !selectedPrize">
            <div class="resource-item" *ngIf="getWheelSpinsCount() > 0">
              <span class="resource-icon">ğŸ°</span>
              <span class="resource-text"
                >{{ getWheelSpinsCount() }} Tiradas de Roleta</span
              >
            </div>
            <div class="resource-item" *ngIf="getDreamConsultationsCount() > 0">
              <span class="resource-icon">ğŸ”®</span>
              <span class="resource-text"
                >{{ getDreamConsultationsCount() }} Consultas disponÃ­veis</span
              >
            </div>
            <div
              class="resource-item"
              *ngIf="
                getWheelSpinsCount() === 0 &&
                getDreamConsultationsCount() === 0 &&
                canSpinWheel
              "
            >
              <span class="resource-icon">ğŸ</span>
              <span class="resource-text">Tirada DiÃ¡ria DisponÃ­vel</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
